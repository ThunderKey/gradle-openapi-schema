plugins {
    id "com.github.muehmar.openapischema" version "0.15.1"
    id "com.diffplug.spotless"
    id 'openapischema.java'
}

dependencies {
    implementation group: 'com.fasterxml.jackson.core', name: 'jackson-core', version: '2.12.2'
    implementation group: 'com.fasterxml.jackson.core', name: 'jackson-databind', version: '2.12.2'
    implementation group: 'com.fasterxml.jackson.core', name: 'jackson-annotations', version: '2.12.2'
    implementation group: 'com.fasterxml.jackson.datatype', name: 'jackson-datatype-jsr310', version: '2.12.2'

    testImplementation group: 'org.junit.jupiter', name: 'junit-jupiter', version: '5.7.1'
    testImplementation group: 'org.junit.jupiter', name: 'junit-jupiter-params', version: '5.7.1'

    implementation group: 'javax.validation', name: 'validation-api', version: '2.0.1.Final'
    implementation group: 'org.hibernate', name: 'hibernate-validator', version: '5.1.1.Final'
    implementation group: 'javax.el', name: 'javax.el-api', version: '2.2.4'
    implementation group: 'org.glassfish.web', name: 'javax.el', version: '2.2.4'
    implementation group: 'javax.xml.ws', name: 'jaxws-api', version: '2.2.11'
}

openApiGenerator {
    enumDescriptionExtraction {
        enabled = true
        prefixMatcher = "`__ENUM__`:"
        failOnIncompleteDescriptions = true
    }

    formatTypeMapping {
        formatType = "username"
        classType = "UserName"
        imports = "com.package.UserName"
    }

    formatTypeMapping {
        formatType = "password"
        classType = "Password"
        imports = "com.package.Password"
    }

    classMapping {
        fromClass = "List"
        toClass = "ArrayList"
        imports = "java.util.ArrayList"
    }
    schemas {
        apiV1 {
            sourceSet = 'main'
            inputSpec = "$projectDir/src/main/resources/openapi-v1.yml"
            outputDir = "$buildDir/generated/openapi"
            packageName = "${project.group}.${project.name}.api.v1.model"
            jsonSupport = "jackson"
            suffix = "Dto"
            enableValidation = true

            enumDescriptionExtraction {
                enabled = true
                prefixMatcher = "`__ENUM__`:"
                failOnIncompleteDescriptions = true
            }

            formatTypeMapping {
                formatType = "username"
                classType = "UserName"
                imports = "com.package.UserName"
            }

            formatTypeMapping {
                formatType = "password"
                classType = "Password"
                imports = "com.package.Password"
            }

            classMapping {
                fromClass = "List"
                toClass = "ArrayList"
                imports = "java.util.ArrayList"
            }
        }
        apiV2 {
            sourceSet = 'main'
            inputSpec = "$projectDir/src/main/resources/openapi-v2.yml"
            outputDir = "$buildDir/generated/openapi"
            packageName = "${project.group}.${project.name}.api.v2.model"
            jsonSupport = "jackson"
            suffix = "Dto"
            enableValidation = true
        }
        inlineObject {
            sourceSet = 'main'
            inputSpec = "$projectDir/src/main/resources/openapi-inline-object.yml"
            outputDir = "$buildDir/generated/openapi"
            packageName = "${project.group}.${project.name}.api.inlineobject.model"
            jsonSupport = "jackson"
            suffix = "Dto"
            enableValidation = true
        }
        inlineObject {
            sourceSet = 'main'
            inputSpec = "$projectDir/src/main/resources/openapi-nullability.yml"
            outputDir = "$buildDir/generated/openapi"
            packageName = "${project.group}.${project.name}.api.nullability.model"
            jsonSupport = "jackson"
            suffix = "Dto"
            enableValidation = true
        }
    }
}

